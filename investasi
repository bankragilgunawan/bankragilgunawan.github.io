<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Sicbo - Investasi 1 Hari</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        
        .gradient-text {
            background: linear-gradient(90deg, #D97706 0%, #F59E0B 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #D97706 0%, #F59E0B 100%);
            box-shadow: 0 4px 15px rgba(217, 119, 6, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(217, 119, 6, 0.4);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .nav-active {
            background: linear-gradient(90deg, #D97706 0%, #F59E0B 100%);
            color: white !important;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(217, 119, 6, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(217, 119, 6, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(217, 119, 6, 0);
            }
        }
        
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #374151;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            background: linear-gradient(90deg, #D97706 0%, #F59E0B 100%);
            transition: width 0.3s ease;
        }
        
        .transaction-item {
            border-bottom: 1px solid #374151;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .dice-icon {
            font-size: 2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .package-card {
            border: 2px solid transparent;
            background: linear-gradient(145deg, #1f2937, #111827) padding-box, linear-gradient(145deg, #374151, #1f2937) border-box;
        }
        
        .package-card:hover {
            background: linear-gradient(145deg, #111827, #0f172a) padding-box, linear-gradient(145deg, #F59E0B, #D97706) border-box;
        }
        
        .package-card.selected {
            background: linear-gradient(145deg, #111827, #0f172a) padding-box, linear-gradient(145deg, #F59E0B, #D97706) border-box;
            transform: scale(1.02);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen text-white">
    <div id="app" class="container mx-auto px-4 py-6 max-w-md">
        <!-- Login Screen -->
        <div id="loginScreen" class="flex flex-col items-center justify-center min-h-screen px-4">
            <div class="text-center mb-8">
                <div class="flex items-center justify-center mb-4">
                    <i class="fas fa-dice-six dice-icon text-yellow-400 mr-3"></i>
                    <h1 class="text-3xl md:text-4xl font-bold gradient-text">Master Sicbo</h1>
                </div>
                <p class="text-slate-300">Investasi 1 hari dengan keuntungan pasti</p>
            </div>

            <div class="bg-slate-800 rounded-2xl p-8 w-full shadow-2xl">
                <h2 class="text-2xl font-bold text-center mb-6">Daftar Sekarang</h2>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Nama Lengkap</label>
                        <input type="text" id="name" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent" placeholder="Masukkan nama Anda">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Nomor WhatsApp</label>
                        <input type="tel" id="phone" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent" placeholder="Contoh: 081234567890">
                    </div>
                </div>

                <button id="registerBtn" class="w-full btn-primary text-white font-bold py-3 px-6 rounded-lg text-lg transition-all duration-300 transform hover:scale-105 pulse">
                    Daftar & Masuk ke WhatsApp
                </button>

                <p class="text-xs text-slate-400 text-center mt-4">
                    Dengan mendaftar, Anda menyetujui syarat dan ketentuan kami
                </p>
            </div>
        </div>

        <!-- Verification Screen -->
        <div id="verificationScreen" class="hidden flex flex-col items-center justify-center min-h-screen px-4">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-comment-dots text-2xl text-white"></i>
                </div>
                <h2 class="text-2xl font-bold mb-2">Cek WhatsApp Anda</h2>
                <p class="text-slate-300 mb-6">Kami telah mengirimkan kode verifikasi ke nomor WhatsApp Anda</p>
                
                <div class="bg-slate-800 rounded-xl p-6 w-full max-w-xs">
                    <p class="text-sm text-slate-400 mb-3">Masukkan kode verifikasi</p>
                    <div class="flex justify-center space-x-2">
                        <input type="text" maxlength="1" class="w-12 h-12 text-center bg-slate-700 border border-slate-600 rounded-lg text-xl font-bold focus:outline-none focus:ring-2 focus:ring-yellow-500" data-index="0">
                        <input type="text" maxlength="1" class="w-12 h-12 text-center bg-slate-700 border border-slate-600 rounded-lg text-xl font-bold focus:outline-none focus:ring-2 focus:ring-yellow-500" data-index="1">
                        <input type="text" maxlength="1" class="w-12 h-12 text-center bg-slate-700 border border-slate-600 rounded-lg text-xl font-bold focus:outline-none focus:ring-2 focus:ring-yellow-500" data-index="2">
                        <input type="text" maxlength="1" class="w-12 h-12 text-center bg-slate-700 border border-slate-600 rounded-lg text-xl font-bold focus:outline-none focus:ring-2 focus:ring-yellow-500" data-index="3">
                        <input type="text" maxlength="1" class="w-12 h-12 text-center bg-slate-700 border border-slate-600 rounded-lg text-xl font-bold focus:outline-none focus:ring-2 focus:ring-yellow-500" data-index="4">
                        <input type="text" maxlength="1" class="w-12 h-12 text-center bg-slate-700 border border-slate-600 rounded-lg text-xl font-bold focus:outline-none focus:ring-2 focus:ring-yellow-500" data-index="5">
                    </div>
                    
                    <p class="text-xs text-slate-400 mt-4">
                        Tidak menerima kode? 
                        <button id="resendCode" class="text-yellow-400 hover:text-yellow-300">Kirim ulang</button>
                    </p>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="mainApp" class="hidden">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h1 class="text-2xl font-bold">Halo, <span id="userName">User</span>!</h1>
                    <p class="text-slate-400 text-sm">Master Sicbo</p>
                </div>
                <div class="w-10 h-10 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-white"></i>
                </div>
            </div>

            <!-- Investment Status -->
            <div class="bg-gradient-to-r from-slate-800 to-slate-700 rounded-2xl p-6 mb-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-yellow-500 rounded-full -mr-12 -mt-12 opacity-20"></div>
                <div class="absolute bottom-0 left-0 w-16 h-16 bg-yellow-500 rounded-full -ml-8 -mb-8 opacity-20"></div>
                
                <div class="relative z-10">
                    <p class="text-slate-400 text-sm">Status Investasi</p>
                    <div class="flex items-center justify-between mt-1">
                        <h2 class="text-2xl font-bold gradient-text" id="investmentStatus">Belum Berinvestasi</h2>
                        <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-clock text-white text-sm"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Investment -->
            <div id="activeInvestment" class="hidden bg-slate-800 rounded-2xl p-6 mb-6">
                <h3 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-check-circle text-green-400 mr-2"></i>
                    Investasi Aktif
                </h3>
                
                <div class="space-y-3">
                    <div class="flex justify-between text-sm">
                        <span class="text-slate-400">Jumlah Investasi:</span>
                        <span id="investmentAmount" class="font-medium">Rp 0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-slate-400">Keuntungan:</span>
                        <span class="font-medium text-green-400" id="profitAmount">+Rp 0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-slate-400">Biaya Transfer:</span>
                        <span class="font-medium text-red-400">-Rp 6.500</span>
                    </div>
                    <div class="flex justify-between text-sm font-bold">
                        <span>Diterima:</span>
                        <span id="receivedAmount" class="gradient-text">Rp 0</span>
                    </div>
                </div>

                <div class="mt-4">
                    <div class="flex justify-between text-xs text-slate-400 mb-1">
                        <span>Waktu Tersisa</span>
                        <span id="countdown">23:59:59</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Investment Packages -->
            <div class="bg-slate-800 rounded-2xl p-6 mb-6">
                <h3 class="text-lg font-bold mb-4">Pilih Paket Investasi</h3>
                <p class="text-sm text-slate-400 mb-4">Investasi 1 hari dengan keuntungan pasti 10%</p>
                
                <div id="packages" class="space-y-4">
                    <!-- Package 1 -->
                    <div class="package-card rounded-xl p-4 cursor-pointer" data-amount="100000" data-profit="10000" data-received="103500">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-lg">Rp 100.000</h4>
                                <p class="text-sm text-slate-400">Keuntungan 10%</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-green-400 font-bold">+Rp 10.000</p>
                                <p class="text-xs text-slate-400">Diterima Rp 103.500</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Package 2 -->
                    <div class="package-card rounded-xl p-4 cursor-pointer" data-amount="250000" data-profit="25000" data-received="268500">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-lg">Rp 250.000</h4>
                                <p class="text-sm text-slate-400">Keuntungan 10%</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-green-400 font-bold">+Rp 25.000</p>
                                <p class="text-xs text-slate-400">Diterima Rp 268.500</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Package 3 -->
                    <div class="package-card rounded-xl p-4 cursor-pointer" data-amount="500000" data-profit="50000" data-received="543500">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-lg">Rp 500.000</h4>
                                <p class="text-sm text-slate-400">Keuntungan 10%</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-green-400 font-bold">+Rp 50.000</p>
                                <p class="text-xs text-slate-400">Diterima Rp 543.500</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Package 4 -->
                    <div class="package-card rounded-xl p-4 cursor-pointer" data-amount="1000000" data-profit="100000" data-received="1093500">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-lg">Rp 1.000.000</h4>
                                <p class="text-sm text-slate-400">Keuntungan 10%</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-green-400 font-bold">+Rp 100.000</p>
                                <p class="text-xs text-slate-400">Diterima Rp 1.093.500</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button id="investBtn" class="w-full btn-primary text-white font-bold py-3 px-6 rounded-lg mt-4 transition-all duration-300 opacity-50 cursor-not-allowed" disabled>
                    Investasi Sekarang
                </button>
            </div>

            <!-- Transaction History -->
            <div class="bg-slate-800 rounded-2xl p-6 mb-20">
                <h3 class="text-lg font-bold mb-4">Riwayat Investasi</h3>
                
                <div id="transactions" class="space-y-3">
                    <!-- Transactions will be added here dynamically -->
                    <div class="text-center py-8 text-slate-500">
                        <i class="fas fa-history text-3xl mb-2 opacity-50"></i>
                        <p class="text-sm">Belum ada riwayat investasi</p>
                    </div>
                </div>
            </div>

            <!-- Bottom Navigation -->
            <div class="fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2">
                <div class="flex justify-around">
                    <button class="nav-active text-center py-2 px-4 rounded-lg">
                        <i class="fas fa-home text-lg"></i>
                        <p class="text-xs mt-1">Beranda</p>
                    </button>
                    <button class="text-center py-2 px-4 rounded-lg text-slate-400">
                        <i class="fas fa-chart-line text-lg"></i>
                        <p class="text-xs mt-1">Statistik</p>
                    </button>
                    <button class="text-center py-2 px-4 rounded-lg text-slate-400">
                        <i class="fas fa-info-circle text-lg"></i>
                        <p class="text-xs mt-1">Info</p>
                    </button>
                    <button class="text-center py-2 px-4 rounded-lg text-slate-400">
                        <i class="fas fa-user text-lg"></i>
                        <p class="text-xs mt-1">Profil</p>
                    </button>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-slate-800 rounded-2xl p-6 w-full max-w-sm">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Konfirmasi Investasi</h3>
                    <button id="closeConfirm" class="text-slate-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div class="bg-slate-700 rounded-lg p-4">
                        <p class="text-sm text-slate-300 mb-2">Anda akan berinvestasi:</p>
                        <p class="text-2xl font-bold gradient-text" id="confirmAmount">Rp 0</p>
                    </div>
                    
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-slate-400">Keuntungan (10%):</span>
                            <span class="text-green-400 font-bold" id="confirmProfit">+Rp 0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">Biaya Transfer:</span>
                            <span class="text-red-400 font-bold">-Rp 6.500</span>
                        </div>
                        <div class="flex justify-between font-bold pt-2 border-t border-slate-600">
                            <span>Diterima:</span>
                            <span class="gradient-text" id="confirmReceived">Rp 0</span>
                        </div>
                    </div>
                    
                    <button id="confirmInvest" class="w-full btn-primary text-white font-bold py-3 px-6 rounded-lg transition-all duration-300">
                        Ya, Investasi Sekarang
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock database - in real app this would be server-side
        const database = {
            users: [
                {
                    id: 1,
                    name: "Budi Santoso",
                    phone: "6281234567890",
                    verificationCode: "123456",
                    activeInvestment: null,
                    transactions: []
                },
                {
                    id: 2,
                    name: "Siti Aminah",
                    phone: "6289876543210",
                    verificationCode: "654321",
                    activeInvestment: {
                        amount: 500000,
                        profit: 50000,
                        received: 543500,
                        startDate: new Date().getTime() - 12 * 60 * 60 * 1000, // 12 hours ago
                        endDate: new Date().getTime() + 12 * 60 * 60 * 1000   // 12 hours from now
                    },
                    transactions: [
                        {
                            id: 1,
                            amount: 100000,
                            profit: 10000,
                            received: 103500,
                            startDate: new Date('2024-01-15').getTime(),
                            endDate: new Date('2024-01-16').getTime(),
                            status: 'completed'
                        },
                        {
                            id: 2,
                            amount: 250000,
                            profit: 25000,
                            received: 268500,
                            startDate: new Date('2024-01-10').getTime(),
                            endDate: new Date('2024-01-11').getTime(),
                            status: 'completed'
                        }
                    ]
                }
            ]
        };

        // Current user data
        let currentUser = null;
        let currentPhone = null;
        let selectedPackage = null;

        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const verificationScreen = document.getElementById('verificationScreen');
        const mainApp = document.getElementById('mainApp');
        const registerBtn = document.getElementById('registerBtn');
        const investBtn = document.getElementById('investBtn');
        const confirmModal = document.getElementById('confirmModal');
        const closeConfirm = document.getElementById('closeConfirm');
        const confirmInvest = document.getElementById('confirmInvest');
        const nameInput = document.getElementById('name');
        const phoneInput = document.getElementById('phone');
        const resendCode = document.getElementById('resendCode');
        const packages = document.getElementById('packages');
        const transactions = document.getElementById('transactions');
        const activeInvestment = document.getElementById('activeInvestment');

        // Format Rupiah
        function formatRupiah(angka) {
            return 'Rp ' + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // Find user by phone number
        function findUserByPhone(phone) {
            // Clean phone number (remove +, spaces, etc.)
            const cleanPhone = phone.replace(/\D/g, '');
            return database.users.find(user => user.phone === cleanPhone);
        }

        // Generate random verification code
        function generateVerificationCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        // Simulate sending WhatsApp message
        function sendWhatsAppVerification(phone, code, name) {
            const message = `Halo ${name}, kode verifikasi Anda untuk Master Sicbo adalah: *${code}*\n\nGunakan kode ini untuk masuk ke aplikasi. Kode ini berlaku selama 10 menit.`;
            const whatsappUrl = `https://wa.me/6282121218466?text=${encodeURIComponent(message)}`;
            
            // In real app, this would send to the user's phone
            // For demo, we're sending to admin with user's info
            window.open(whatsappUrl, '_blank');
            
            // Store the code temporarily (in real app this would be server-side with expiration)
            setTimeout(() => {
                console.log(`Verification code ${code} sent to ${phone}`);
            }, 1000);
        }

        // Update UI with user data
        function updateUI() {
            if (!currentUser) return;
            
            document.getElementById('userName').textContent = currentUser.name;
            
            // Update investment status
            const investmentStatus = document.getElementById('investmentStatus');
            const investBtn = document.getElementById('investBtn');
            
            if (currentUser.activeInvestment) {
                // Show active investment
                activeInvestment.classList.remove('hidden');
                
                document.getElementById('investmentAmount').textContent = formatRupiah(currentUser.activeInvestment.amount);
                document.getElementById('profitAmount').textContent = '+' + formatRupiah(currentUser.activeInvestment.profit);
                document.getElementById('receivedAmount').textContent = formatRupiah(currentUser.activeInvestment.received);
                
                investmentStatus.textContent = 'Investasi Aktif';
                investmentStatus.classList.remove('text-slate-300');
                investmentStatus.classList.add('text-green-400');
                
                // Disable investment button
                investBtn.disabled = true;
                investBtn.classList.add('opacity-50', 'cursor-not-allowed');
                
                // Start countdown
                startCountdown();
            } else {
                // Hide active investment
                activeInvestment.classList.add('hidden');
                
                investmentStatus.textContent = 'Belum Berinvestasi';
                investmentStatus.classList.remove('text-green-400');
                investmentStatus.classList.add('text-slate-300');
                
                // Enable investment button if package selected
                if (selectedPackage) {
                    investBtn.disabled = false;
                    investBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }
            
            // Update transaction history
            updateTransactions();
        }

        // Update transaction history
        function updateTransactions() {
            const transactionsContainer = document.getElementById('transactions');
            
            if (currentUser.transactions.length === 0) {
                transactionsContainer.innerHTML = `
                    <div class="text-center py-8 text-slate-500">
                        <i class="fas fa-history text-3xl mb-2 opacity-50"></i>
                        <p class="text-sm">Belum ada riwayat investasi</p>
                    </div>
                `;
                return;
            }
            
            // Sort transactions by date (newest first)
            const sortedTransactions = [...currentUser.transactions].sort((a, b) => b.endDate - a.endDate);
            
            transactionsContainer.innerHTML = '';
            
            sortedTransactions.forEach(transaction => {
                const transactionElement = document.createElement('div');
                transactionElement.className = 'transaction-item py-3';
                
                const status = new Date() > new Date(transaction.endDate) ? 'Selesai' : 'Dalam Proses';
                const statusClass = new Date() > new Date(transaction.endDate) ? 'text-green-400' : 'text-yellow-400';
                
                transactionElement.innerHTML = `
                    <div class="flex justify-between">
                        <div>
                            <p class="font-medium">${formatRupiah(transaction.amount)}</p>
                            <p class="text-xs text-slate-400">${new Date(transaction.startDate).toLocaleDateString('id-ID')}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold gradient-text">${formatRupiah(transaction.received)}</p>
                            <span class="text-xs ${statusClass} px-2 py-1 rounded-full mt-1 inline-block">
                                ${status}
                            </span>
                        </div>
                    </div>
                `;
                transactionsContainer.appendChild(transactionElement);
            });
        }

        // Start countdown for active investment
        function startCountdown() {
            const countdown = document.getElementById('countdown');
            const progressFill = document.getElementById('progressFill');
            
            function updateCountdown() {
                if (!currentUser.activeInvestment) return;
                
                const now = new Date().getTime();
                const endTime = currentUser.activeInvestment.endDate;
                const timeLeft = endTime - now;
                
                if (timeLeft <= 0) {
                    // Investment completed
                    clearInterval(countdownInterval);
                    countdown.textContent = 'Selesai';
                    progressFill.style.width = '100%';
                    
                    // Move active investment to transactions
                    const completedInvestment = { ...currentUser.activeInvestment };
                    currentUser.transactions.unshift(completedInvestment);
                    currentUser.activeInvestment = null;
                    
                    // Update UI
                    updateUI();
                } else {
                    // Calculate remaining time
                    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                    
                    // Format time
                    const displayTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    countdown.textContent = displayTime;
                    
                    // Update progress bar
                    const totalDuration = currentUser.activeInvestment.endDate - currentUser.activeInvestment.startDate;
                    const elapsed = now - currentUser.activeInvestment.startDate;
                    const progress = (elapsed / totalDuration) * 100;
                    progressFill.style.width = `${Math.min(progress, 100)}%`;
                }
            }
            
            // Initial update
            updateCountdown();
            
            // Update every second
            const countdownInterval = setInterval(updateCountdown, 1000);
        }

        // Register new user or find existing one
        registerBtn.addEventListener('click', function() {
            const name = nameInput.value.trim();
            const phone = phoneInput.value.trim();
            
            if (!name || !phone) {
                alert('Mohon isi semua data terlebih dahulu');
                return;
            }
            
            // Clean phone number
            currentPhone = phone.replace(/\D/g, '');
            if (!currentPhone.startsWith('62')) {
                currentPhone = '62' + currentPhone.replace(/^0+/, '');
            }
            
            // Check if user exists
            let user = findUserByPhone(currentPhone);
            
            if (!user) {
                // Create new user
                const newCode = generateVerificationCode();
                user = {
                    id: database.users.length + 1,
                    name: name,
                    phone: currentPhone,
                    verificationCode: newCode,
                    activeInvestment: null,
                    transactions: []
                };
                database.users.push(user);
            } else {
                // Update name if different
                if (user.name !== name) {
                    user.name = name;
                }
            }
            
            // Send verification code via WhatsApp
            sendWhatsAppVerification(currentPhone, user.verificationCode, name);
            
            // Show verification screen
            loginScreen.classList.add('hidden');
            verificationScreen.classList.remove('hidden');
            
            // Focus first input
            const inputs = verificationScreen.querySelectorAll('input');
            if (inputs.length > 0) {
                inputs[0].focus();
            }
        });

        // Handle verification code input
        verificationScreen.addEventListener('input', function(e) {
            const input = e.target;
            if (input.tagName === 'INPUT' && input.value.length === 1) {
                const index = parseInt(input.dataset.index);
                if (index < 5) {
                    const nextInput = verificationScreen.querySelector(`input[data-index="${index + 1}"]`);
                    if (nextInput) {
                        nextInput.focus();
                    }
                }
            }
        });

        // Handle backspace to go to previous input
        verificationScreen.addEventListener('keydown', function(e) {
            const input = e.target;
            if (input.tagName === 'INPUT' && e.key === 'Backspace' && input.value === '') {
                const index = parseInt(input.dataset.index);
                if (index > 0) {
                    const prevInput = verificationScreen.querySelector(`input[data-index="${index - 1}"]`);
                    if (prevInput) {
                        prevInput.focus();
                    }
                }
            }
        });

        // Resend verification code
        resendCode.addEventListener('click', function() {
            if (!currentPhone) return;
            
            const user = findUserByPhone(currentPhone);
            if (user) {
                const newCode = generateVerificationCode();
                user.verificationCode = newCode;
                sendWhatsAppVerification(currentPhone, newCode, user.name);
                alert('Kode verifikasi baru telah dikirim ke WhatsApp Anda');
            }
        });

        // Verify code when all inputs are filled
        verificationScreen.addEventListener('input', function() {
            const inputs = verificationScreen.querySelectorAll('input');
            const code = Array.from(inputs).map(input => input.value).join('');
            
            if (code.length === 6) {
                const user = findUserByPhone(currentPhone);
                if (user && user.verificationCode === code) {
                    currentUser = user;
                    verificationScreen.classList.add('hidden');
                    mainApp.classList.remove('hidden');
                    updateUI();
                } else {
                    alert('Kode verifikasi salah. Silakan coba lagi.');
                    inputs.forEach(input => input.value = '');
                    inputs[0].focus();
                }
            }
        });

        // Handle package selection
        packages.addEventListener('click', function(e) {
            const packageCard = e.target.closest('.package-card');
            if (!packageCard) return;
            
            // Remove selection from all packages
            document.querySelectorAll('.package-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select this package
            packageCard.classList.add('selected');
            
            // Store selected package data
            selectedPackage = {
                amount: parseInt(packageCard.dataset.amount),
                profit: parseInt(packageCard.dataset.profit),
                received: parseInt(packageCard.dataset.received)
            };
            
            // Enable investment button
            const investBtn = document.getElementById('investBtn');
            investBtn.disabled = false;
            investBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        });

        // Show confirmation modal
        investBtn.addEventListener('click', function() {
            if (!selectedPackage) return;
            
            // Update confirmation modal
            document.getElementById('confirmAmount').textContent = formatRupiah(selectedPackage.amount);
            document.getElementById('confirmProfit').textContent = '+' + formatRupiah(selectedPackage.profit);
            document.getElementById('confirmReceived').textContent = formatRupiah(selectedPackage.received);
            
            // Show modal
            confirmModal.classList.remove('hidden');
        });

        // Close confirmation modal
        closeConfirm.addEventListener('click', function() {
            confirmModal.classList.add('hidden');
        });

        // Confirm investment
        confirmInvest.addEventListener('click', function() {
            if (!selectedPackage || !currentUser) return;
            
            // Create active investment
            const now = new Date().getTime();
            const oneDay = 24 * 60 * 60 * 1000; // 24 hours in milliseconds
            
            currentUser.activeInvestment = {
                amount: selectedPackage.amount,
                profit: selectedPackage.profit,
                received: selectedPackage.received,
                startDate: now,
                endDate: now + oneDay
            };
            
            // Update UI
            updateUI();
            
            // Close modal
            confirmModal.classList.add('hidden');
            
            alert(`Investasi berhasil! Anda akan menerima ${formatRupiah(selectedPackage.received)} dalam 24 jam.`);
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === confirmModal) {
                confirmModal.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
